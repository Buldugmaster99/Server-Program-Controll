<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Test</title>
        <script src="sha256.js"></script>
        <script>
            let websocket;

            function send(_action ,_id, extra = null) {
                websocket.send(JSON.stringify({...{ action: _action, id: _id, code: getcode()},...extra}));
                console.log("Message send: " + JSON.stringify({...{ action: _action, id: _id, code: getcode()},...extra}));
            }

            let code = "test"

            function getcode() {
                return SHA256(code)
            }

            function recivelogs(data) {
                data.forEach((log) => {
                    console.log("log: ", log);
                });
            }

            function reciveactivity(data) {
                data.forEach((activity) => {
                    console.log("activity: ", activity);
                });
            }

            function recivestart(data,error) {
                if (error != null) {
                    if (error == "Permissionerror") {
                        console.log("PermissionError")
                    } else {
                        console.log("unexpected Error")
                    }
                    return
                }
                if (data == true) {
                    console.log("success")
                } else {
                    console.log("not successfull")
                }
            }

            function recivestop(data,error) {
                if (error != null) {
                    if (error == "Permissionerror") {
                        console.log("PermissionError")
                    } else {
                        console.log("unexpected Error")
                    }
                    return
                }
                if (data == true) {
                    console.log("success")
                } else {
                    console.log("not successfull")
                }
            }

            function recivecustomaction(data,error) {
                if (error != null) {
                    if (error == "Permissionerror") {
                        console.log("PermissionError")
                    } else {
                        console.log("unexpected Error")
                    }
                    return
                }
                if (data == true) {
                    console.log("success")
                } else {
                    console.log("not successfull")
                }
            }

            const Action = {
                getactivity: "getactivity",
                getlogs: "getlogs",
                start: "start",
                stop: "stop",
                customaction: "customaction",
            };
            
            function processreceived(evt) {
                console.log("Message received: " + evt.data);
                var data = JSON.parse(evt.data);
                switch (data["action"]) {
                    case Action.getlogs:
                        recivelogs(data["data"]);
                        break;
                    case Action.getactivity:
                        reciveactivity(data["data"]);
                        break;

                    case Action.start:
                        recivestart(data["data"],data["error"]);
                        break;

                    case Action.stop:
                        recivestop(data["data"],data["error"]);
                        break;

                    case Action.customaction:
                        recivecustomaction(data["data"],data["error"]);
                        break;

                    default:
                        console.log("invalid action: " + data["action"]);
                        break;
                }
            };

            function builtWebSocket() {
                try {
                    websocket = new WebSocket("ws://" + window.location.host + ":18769/ws");
                    console.log("Connection built");
                } catch (err) {
                    alert("Connection invalid");
                    fail;
                }

                websocket.onopen = function () {
                    websocket.send("connection opened!");
                    console.log("connection opened!");
                };

                websocket.onerror = function (error) {
                    console.log("WebSocket Error: " + error);
                    alert("WebSocket Error");
                };

                websocket.onclose = function () {
                    console.log("Connection lost");
                    alert("Connection lost");
                };  

                websocket.onmessage = processreceived
            }
            builtWebSocket();
        </script>
    </head>
    <body>
        <button id="log">logs</button>
        <button id="act">activity</button>
        <button id="str">start</button>
        <button id="stp">stop</button>
        <button id="cst">customaction</button>
        <input id="csi" type="text"></input>
        <script>
            document.getElementById("act").onclick = function () {
                send(Action.getactivity,"60babca782168")            
            };

            document.getElementById("log").onclick = function () {
                send(Action.getlogs,"60babca782168")            
            };

            document.getElementById("str").onclick = function () {
                send(Action.start,"60babca782168")
            };

            document.getElementById("stp").onclick = function () {
                send(Action.stop,"60babca782168")
            };

            document.getElementById("cst").onclick = function () {
                send(Action.customaction,"60babca782168",{customaction: document.getElementById("csi").value}) 
            };
        </script>
    </body>
</html>
